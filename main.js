!function(){"use strict";const e=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}editProfile(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}addCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}loadData(){return Promise.all([this.getUserInfo(),this.getInitialCards()]).then((e=>{let[t,n]=e;return{userInfo:t,initialCards:n}}))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"c7f5c92f-7ce5-490b-8dc6-c25c01900635","Content-Type":"application/json"}});var t=e;class n{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._config.inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._config.inactiveButtonClass),this._buttonElement.disabled=!1)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""}_showInputError(e,t){const n=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._config.inputErrorClass),n.textContent=t,n.classList.add(this._config.errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}}class r{constructor(e,t,n,r,s,i,o){this._name=e.name,this._link=e.link,this._id=e._id,this._likes=e.likes,this._ownerId=e.owner._id,this._cardSelector=t,this._openImageModal=n,this._handleLike=r,this._handleDelete=s,this._cardList=o,this._userId=i}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._element.querySelector(".card__like-button").addEventListener("click",(()=>{this._handleLike(this)})),this._element.querySelector(".card__image").addEventListener("click",(()=>{this._openImageModal({name:this._name,link:this._link})})),this._element.querySelector(".card__delete-button").addEventListener("click",(e=>{e.preventDefault(),this._handleDelete(this._id)}))}deleteCard(){this._element.remove(),this._element=null}updateLikes(e){this._likes=e,this._renderLikes()}_renderLikes(){this._element.querySelector(".card__like-count").textContent=this._likes.length,this._element.querySelector(".card__like-button").classList.toggle("card__like-button_active",this.isLiked())}isLiked(){return this._likes.some((e=>e._id===this._userId))}getId(){return this._id}generateCard(){return this._element=this._getTemplate(),this._element.setAttribute("data-id",this._id),this._element.querySelector(".card__title").textContent=this._name,this._element.querySelector(".card__image").src=this._link,this._element.querySelector(".card__image").alt=this._name,this._renderLikes(),this._setEventListeners(),this._userId!==this._ownerId&&this._element.querySelector(".card__delete-button").remove(),this._element}}var s=class{constructor(e){this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this._closeButton=this._popupElement.querySelector(".modal__close")}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(()=>this.close())),this._popupElement.addEventListener("click",(e=>{e.target===this._popupElement&&this.close()}))}};class i extends s{constructor(e,t,n){super(e),this._handleSubmit=t,this._formElement=this._popupElement.querySelector("form"),this._submitButton=this._formElement.querySelector(".modal__button[type='submit']"),this._buttonText=this._submitButton.textContent,this._loadingButtonText=n}close(){super.close(),this._formElement.reset()}renderLoading(e){this._submitButton.textContent=e?this._loadingButtonText:this._buttonText}_getInputValues(){const e=this._formElement.querySelectorAll("input"),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._getInputValues())}))}}document.querySelector(".profile__avatar"),document.querySelector(".profile__title"),document.querySelector(".profile__description");const o=document.querySelector("#profile-edit-button"),a=document.querySelector("#profile-title-input"),l=document.querySelector("#profile-description-input"),d=document.querySelector(".profile__add-button"),c=(document.querySelector(".card__list"),document.querySelector("#add-modal-title-input"),document.querySelector("#cardUrlInput"),document.querySelector(".profile__hover-edit")),h=(document.querySelector("#edit-avatar-modal"),document.querySelector("#edit-avatar-modal-close-button"));let _,u,m;function p(e){console.trace(`handleCardDelete called with ID: ${e}`),console.log("cardId",e),C.open(e),C.setConfirmHandler((()=>{C.renderLoading(!0),t.deleteCard(e).then((()=>{console.log(`Deleted card with ID: ${e}`),m.removeItem(e),C.close()})).catch((e=>{console.error(`Failed to delete card: ${e}`)})).finally((()=>{C.renderLoading(!1)}))}))}function v(e,t){return new r(e,"#card-template",f,E,p,t,m).generateCard()}function f(e){q.open(e)}function E(e){e.isLiked()?t.removeLike(e._id).then((t=>(e.updateLikes(t.likes),t))).catch((e=>{console.error(`Failed to remove like: ${e}`)})):t.addLike(e._id).then((t=>(e.updateLikes(t.likes),t))).catch((e=>{console.error(`Failed to add like: ${e}`)}))}document.querySelector("#edit-avatar-form"),document.querySelector("#avatar-url-input"),document.getElementById("edit-profile-create-button"),t.loadData().then((e=>{let{userInfo:t,initialCards:n}=e;u=new class{constructor(e){let{nameSelector:t,jobSelector:n,avatarSelector:r}=e;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(n),this._avatarElement=document.querySelector(r)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent,avatar:this._avatarElement.src}}setUserInfo(e,t,n){this._nameElement.textContent=e,this._jobElement.textContent=t,this._avatarElement.src=n}getAvatar(){return this._avatarElement.src}setAvatar(e){this._avatarElement.src=e}}({nameSelector:".profile__title",jobSelector:".profile__description",avatarSelector:".profile__avatar"}),u.setUserInfo(t.name,t.about),u.setAvatar(t.avatar),_=t._id,m=new class{constructor(e,t){let{items:n,renderer:r}=e;this._items=n,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.reverse().forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}removeItem(e){console.log(`Trying to remove item with id: ${e}`);const t=this._container.querySelector(`[data-id="${e}"]`);console.log("Found item element: ",t),t&&(t.remove(),console.log(`Item with id: ${e} removed.`))}}({items:n,renderer:e=>{const t=v(e,_);m.addItem(t)}},".card__list"),m.renderItems()})).catch((e=>{console.error(`Failed to get user info and initial cards: ${e}`)})),c.addEventListener("click",(()=>b.open())),o.addEventListener("click",(()=>{const e=u.getUserInfo();a.value=e.name,l.value=e.job,L.resetValidation(),y.open()})),h.addEventListener("click",(()=>{b.close()})),d.addEventListener("click",(()=>{S.resetValidation(),k.open()}));const g={inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},L=new n(g,document.querySelector("#profile-edit-modal form"));L.enableValidation();const S=new n(g,document.querySelector("#add-modal form"));S.enableValidation();const b=new i("#edit-avatar-modal",(function(e){b.renderLoading(!0),t.updateAvatar(e.avatar).then((()=>{u.setAvatar(e.avatar),b.close()})).catch((e=>{console.error(e)})).finally((()=>{b.renderLoading(!1)}))}),"Saving...");b.setEventListeners();const y=new i("#profile-edit-modal",(function(e){y.renderLoading(!0);const n=a,r=l;t.editProfile(n.value,r.value).then((e=>{u.setUserInfo(e.name,e.about,u.getAvatar()),y.close()})).catch((e=>{console.error(e)})).finally((()=>{y.renderLoading(!1)}))}),"Saving...");y.setEventListeners();const k=new i("#add-modal",(function(e){k.renderLoading(!0),t.addCard(e.name,e.link).then((e=>{if(!e||!e._id)throw new Error("Invalid card data received from the server");{const t=v(e,_);m.addItem(t),k.close()}})).catch((e=>{console.error(`Failed to add card: ${e}`)})).finally((()=>{k.renderLoading(!1)}))}),"Saving...");k.setEventListeners();const C=new class extends s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";super(e),this._confirmButton=this._popupElement.querySelector(".modal__close"),this._confirmButtonText=this._confirmButton.textContent,this._confirmDeleteButton=this._popupElement.querySelector(".modal__delete-button"),this._submitButton=this._popupElement.querySelector(".modal__delete-button"),this._buttonText=this._submitButton.textContent,this._loadingButtonText=t}setConfirmHandler(e){this._confirmHandler=e,this._confirmButton.addEventListener("click",(e=>{e.preventDefault(),this._confirmHandler()})),this._confirmDeleteButton.addEventListener("click",(e=>{e.preventDefault(),this._confirmHandler()}))}close(){super.close(),this._confirmButton.removeEventListener("click",this._confirmHandler),this._confirmDeleteButton.removeEventListener("click",this._confirmHandler)}renderLoading(e){console.log("renderLoading called with: ",e),this._submitButton.textContent=e?this._loadingButtonText:this._buttonText,console.log("Button text after renderLoading: ",this._submitButton.textContent)}}("#delete-modal");C.setEventListeners();const q=new class extends s{constructor(e){super(e),this._imageElement=this._popupElement.querySelector(".modal__preview-image"),this._imageCaption=this._popupElement.querySelector(".modal__preview-title")}open(e){this._imageElement.src=e.link,this._imageElement.alt=e.name,this._imageCaption.textContent=e.name,super.open()}}("#preview__image-modal");q.setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUtzSCxjQUFjckUsY0FDdEMseUJBRUZqRCxLQUFLc04sY0FBZ0J0TixLQUFLc0gsY0FBY3JFLGNBQ3RDLHdCQUVKLENBRUF5RSxLQUFLNkYsR0FDSHZOLEtBQUtxTixjQUFjbEcsSUFBTW9HLEVBQVUvTCxLQUNuQ3hCLEtBQUtxTixjQUFjakcsSUFBTW1HLEVBQVV0TSxLQUNuQ2pCLEtBQUtzTixjQUFjbkosWUFBY29KLEVBQVV0TSxLQUUzQ21ILE1BQU1WLE1BQ1IsR0gyUWdDLHlCQUNsQ3dDLEVBQVdwQyxtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0ltYWdlUG9wdXAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBvcHRpb25zLmJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7IGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMgfSkudGhlbihcbiAgICAgIHRoaXMuX2NoZWNrUmVzcG9uc2VcbiAgICApO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHsgaGVhZGVyczogdGhpcy5faGVhZGVycyB9KS50aGVuKFxuICAgICAgdGhpcy5fY2hlY2tSZXNwb25zZVxuICAgICk7XG4gIH1cblxuICBlZGl0UHJvZmlsZShuYW1lLCBhYm91dCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgYWRkQ2FyZChuYW1lLCBsaW5rKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgYWRkTGlrZShjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgcmVtb3ZlTGlrZShjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgdXBkYXRlQXZhdGFyKGF2YXRhckxpbmspIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXI6IGF2YXRhckxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgbG9hZERhdGEoKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKS50aGVuKFxuICAgICAgKFt1c2VySW5mbywgaW5pdGlhbENhcmRzXSkgPT4ge1xuICAgICAgICByZXR1cm4geyB1c2VySW5mbywgaW5pdGlhbENhcmRzIH07XG4gICAgICB9XG4gICAgKTtcbiAgfVxufVxuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcImM3ZjVjOTJmLTdjZTUtNDkwYi04ZGM2LWMyNWMwMTkwMDYzNVwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGFwaTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3Rvcihjb25maWcsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XG5cbiAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9jb25maWcuaW5wdXRTZWxlY3RvcilcbiAgICApO1xuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgdGhpcy5fY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgKTtcbiAgfVxuXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+ICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpO1xuICB9XG5cbiAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2NvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcblxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2NvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2NvbmZpZy5lcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICAgICk7XG5cbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9jb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fY29uZmlnLmVycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICByZXNldFZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9KTtcblxuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3RvcihcbiAgICBjYXJkRGF0YSxcbiAgICBjYXJkVGVtcGxhdGVTZWxlY3RvcixcbiAgICBvcGVuSW1hZ2VNb2RhbCxcbiAgICBoYW5kbGVDYXJkTGlrZSxcbiAgICBoYW5kbGVDYXJkRGVsZXRlLFxuICAgIHVzZXJJZCxcbiAgICBjYXJkTGlzdFxuICApIHtcbiAgICB0aGlzLl9uYW1lID0gY2FyZERhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gY2FyZERhdGEubGluaztcbiAgICB0aGlzLl9pZCA9IGNhcmREYXRhLl9pZDtcbiAgICB0aGlzLl9saWtlcyA9IGNhcmREYXRhLmxpa2VzO1xuICAgIHRoaXMuX293bmVySWQgPSBjYXJkRGF0YS5vd25lci5faWQ7XG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFRlbXBsYXRlU2VsZWN0b3I7XG4gICAgdGhpcy5fb3BlbkltYWdlTW9kYWwgPSBvcGVuSW1hZ2VNb2RhbDtcbiAgICB0aGlzLl9oYW5kbGVMaWtlID0gaGFuZGxlQ2FyZExpa2U7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlID0gaGFuZGxlQ2FyZERlbGV0ZTtcbiAgICB0aGlzLl9jYXJkTGlzdCA9IGNhcmRMaXN0O1xuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcbiAgfVxuXG4gIF9nZXRUZW1wbGF0ZSgpIHtcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgcmV0dXJuIGNhcmRFbGVtZW50O1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2VsZW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5faGFuZGxlTGlrZSh0aGlzKTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy5fZWxlbWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLl9vcGVuSW1hZ2VNb2RhbCh7IG5hbWU6IHRoaXMuX25hbWUsIGxpbms6IHRoaXMuX2xpbmsgfSk7XG4gICAgICB9KTtcbiAgICBjb25zdCBkZWxldGVCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcbiAgICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZSh0aGlzLl9pZCk7XG4gICAgfSk7XG4gIH1cbiAgZGVsZXRlQ2FyZCgpIHtcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xuICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgdXBkYXRlTGlrZXMobGlrZXMpIHtcbiAgICB0aGlzLl9saWtlcyA9IGxpa2VzO1xuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XG4gIH1cblxuICBfcmVuZGVyTGlrZXMoKSB7XG4gICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtY291bnRcIikudGV4dENvbnRlbnQgPVxuICAgICAgdGhpcy5fbGlrZXMubGVuZ3RoO1xuICAgIHRoaXMuX2VsZW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXG4gICAgICAuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiLCB0aGlzLmlzTGlrZWQoKSk7XG4gIH1cblxuICBpc0xpa2VkKCkge1xuICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fdXNlcklkKTtcbiAgfVxuXG4gIGdldElkKCkge1xuICAgIHJldHVybiB0aGlzLl9pZDtcbiAgfVxuXG4gIGdlbmVyYXRlQ2FyZCgpIHtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcbiAgICB0aGlzLl9lbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgdGhpcy5faWQpO1xuICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG4gICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpLmFsdCA9IHRoaXMuX25hbWU7XG5cbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgaWYgKHRoaXMuX3VzZXJJZCAhPT0gdGhpcy5fb3duZXJJZCkge1xuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIikucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XG4gIH1cbn1cbiIsImNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuXG4gIHJlbmRlckl0ZW1zKCkge1xuICAgIHRoaXMuX2l0ZW1zLnJldmVyc2UoKS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG4gIHJlbW92ZUl0ZW0oaXRlbUlkKSB7XG4gICAgY29uc29sZS5sb2coYFRyeWluZyB0byByZW1vdmUgaXRlbSB3aXRoIGlkOiAke2l0ZW1JZH1gKTtcbiAgICBjb25zdCBpdGVtRWxlbWVudCA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKGBbZGF0YS1pZD1cIiR7aXRlbUlkfVwiXWApO1xuICAgIGNvbnNvbGUubG9nKGBGb3VuZCBpdGVtIGVsZW1lbnQ6IGAsIGl0ZW1FbGVtZW50KTtcbiAgICBpZiAoaXRlbUVsZW1lbnQpIHtcbiAgICAgIGl0ZW1FbGVtZW50LnJlbW92ZSgpO1xuICAgICAgY29uc29sZS5sb2coYEl0ZW0gd2l0aCBpZDogJHtpdGVtSWR9IHJlbW92ZWQuYCk7XG4gICAgfVxuICB9XG59XG5leHBvcnQgZGVmYXVsdCBTZWN0aW9uO1xuIiwiY2xhc3MgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VcIik7XG4gIH1cblxuICBvcGVuKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIF9oYW5kbGVFc2NDbG9zZShldmVudCkge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9jbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5jbG9zZSgpKTtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gdGhpcy5fcG9wdXBFbGVtZW50KSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3B1cDtcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVTdWJtaXQsIGxvYWRpbmdCdXR0b25UZXh0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJmb3JtXCIpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5tb2RhbF9fYnV0dG9uW3R5cGU9J3N1Ym1pdCddXCJcbiAgICApO1xuICAgIHRoaXMuX2J1dHRvblRleHQgPSB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQ7XG4gICAgdGhpcy5fbG9hZGluZ0J1dHRvblRleHQgPSBsb2FkaW5nQnV0dG9uVGV4dDtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTsgLy8gcmVzZXRzIHRoZSBmb3JtIGlucHV0c1xuICB9XG5cbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9sb2FkaW5nQnV0dG9uVGV4dDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy5fYnV0dG9uVGV4dDtcbiAgICB9XG4gIH1cblxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRzID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcImlucHV0XCIpO1xuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XG4gICAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiBpbnB1dFZhbHVlcztcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVTdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCBhcGkgZnJvbSBcIi4uL3V0aWxzL0FwaVwiO1xuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvclwiO1xuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZFwiO1xuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgSW1hZ2VQb3B1cCBmcm9tIFwiLi4vY29tcG9uZW50cy9JbWFnZVBvcHVwLmpzXCI7XG5pbXBvcnQgXCIuLi9wYWdlcy9pbmRleC5jc3NcIjtcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uXCI7XG5cbi8vIERPTSBFbGVtZW50c1xuY29uc3QgYXZhdGFySW1hZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBwcm9maWxlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3RpdGxlXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWVkaXQtYnV0dG9uXCIpO1xuY29uc3QgcHJvZmlsZVRpdGxlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtdGl0bGUtaW5wdXRcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmNvbnN0IGFkZE5ld0NhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XG5jb25zdCBjYXJkTGlzdEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saXN0XCIpO1xuY29uc3QgY2FyZFRpdGxlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1tb2RhbC10aXRsZS1pbnB1dFwiKTtcbmNvbnN0IGNhcmRVcmxJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZFVybElucHV0XCIpO1xuY29uc3QgYXZhdGFyRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faG92ZXItZWRpdFwiKTtcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhck1vZGFsQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNlZGl0LWF2YXRhci1tb2RhbC1jbG9zZS1idXR0b25cIlxuKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLWZvcm1cIik7XG5jb25zdCBhdmF0YXJVcmxJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLXVybC1pbnB1dFwiKTtcbmNvbnN0IGFkZE1vZGFsQ3JlYXRlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gIFwiZWRpdC1wcm9maWxlLWNyZWF0ZS1idXR0b25cIlxuKTtcblxuLy8gSW5zdGFuY2Ugb2YgdGhlIFVzZXJJbmZvIGNsYXNzXG5sZXQgdXNlcklkO1xubGV0IHVzZXJJbmZvO1xubGV0IGNhcmRMaXN0O1xuXG4vLyBJbml0aWFsaXplIEFQSSBhbmQgcmV0cmlldmUgdXNlciBpbmZvIGFuZCBpbml0aWFsIGNhcmRzXG5hcGlcbiAgLmxvYWREYXRhKClcbiAgLnRoZW4oKHsgdXNlckluZm86IHVzZXJJbmZvRGF0YSwgaW5pdGlhbENhcmRzIH0pID0+IHtcbiAgICB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gICAgICBuYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gICAgICBqb2JTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbiAgICAgIGF2YXRhclNlbGVjdG9yOiBcIi5wcm9maWxlX19hdmF0YXJcIixcbiAgICB9KTtcblxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXJJbmZvRGF0YS5uYW1lLCB1c2VySW5mb0RhdGEuYWJvdXQpO1xuICAgIHVzZXJJbmZvLnNldEF2YXRhcih1c2VySW5mb0RhdGEuYXZhdGFyKTsgLy8gQXZhdGFyIGlzIHNldCBvbmNlIGFuZCBub3QgdXBkYXRlZCB3aXRoIHByb2ZpbGUgaW5mb1xuICAgIHVzZXJJZCA9IHVzZXJJbmZvRGF0YS5faWQ7XG5cbiAgICAvLyBDYXJkIExpc3RcbiAgICBjYXJkTGlzdCA9IG5ldyBTZWN0aW9uKFxuICAgICAge1xuICAgICAgICBpdGVtczogaW5pdGlhbENhcmRzLFxuICAgICAgICByZW5kZXJlcjogKGNhcmREYXRhKSA9PiB7XG4gICAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKGNhcmREYXRhLCB1c2VySWQpO1xuICAgICAgICAgIGNhcmRMaXN0LmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIFwiLmNhcmRfX2xpc3RcIlxuICAgICk7XG5cbiAgICBjYXJkTGlzdC5yZW5kZXJJdGVtcygpO1xuICB9KVxuICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGdldCB1c2VyIGluZm8gYW5kIGluaXRpYWwgY2FyZHM6ICR7ZXJyb3J9YCk7XG4gIH0pO1xuXG4vL1Byb2ZpbGUgRWRpdCBGb3JtXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdChmb3JtRGF0YSkge1xuICBwcm9maWxlRWRpdFBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG5cbiAgY29uc3QgbmFtZUlucHV0ID0gcHJvZmlsZVRpdGxlSW5wdXQ7XG4gIGNvbnN0IGpvYklucHV0ID0gcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQ7XG5cbiAgYXBpXG4gICAgLmVkaXRQcm9maWxlKG5hbWVJbnB1dC52YWx1ZSwgam9iSW5wdXQudmFsdWUpXG4gICAgLnRoZW4oKHVwZGF0ZWRJbmZvKSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyhcbiAgICAgICAgdXBkYXRlZEluZm8ubmFtZSxcbiAgICAgICAgdXBkYXRlZEluZm8uYWJvdXQsXG4gICAgICAgIHVzZXJJbmZvLmdldEF2YXRhcigpXG4gICAgICApO1xuICAgICAgcHJvZmlsZUVkaXRQb3B1cC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwcm9maWxlRWRpdFBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpOyAvLyBNb3ZlZCByZW5kZXJMb2FkaW5nKGZhbHNlKSBpbnRvIGZpbmFsbHkgYmxvY2tcbiAgICB9KTtcbn1cblxuLy8gQXZhdGFyIEZvcm1cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQoZm9ybURhdGEpIHtcbiAgYXZhdGFyUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlKTtcblxuICBhcGlcbiAgICAudXBkYXRlQXZhdGFyKGZvcm1EYXRhLmF2YXRhcilcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRBdmF0YXIoZm9ybURhdGEuYXZhdGFyKTtcbiAgICAgIGF2YXRhclBvcHVwLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAvLyBIYW5kbGUgeW91ciBlcnJvciBhcHByb3ByaWF0ZWx5IGhlcmVcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgYXZhdGFyUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XG4gICAgfSk7XG59XG5cbi8vIEFkZCBDYXJkIEZvcm1cblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZEZvcm1TdWJtaXQoZm9ybURhdGEpIHtcbiAgYWRkQ2FyZFBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG5cbiAgYXBpXG5cbiAgICAuYWRkQ2FyZChmb3JtRGF0YS5uYW1lLCBmb3JtRGF0YS5saW5rKVxuXG4gICAgLnRoZW4oKG5ld0NhcmREYXRhKSA9PiB7XG4gICAgICBpZiAobmV3Q2FyZERhdGEgJiYgbmV3Q2FyZERhdGEuX2lkKSB7XG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChuZXdDYXJkRGF0YSwgdXNlcklkKTtcbiAgICAgICAgY2FyZExpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XG5cbiAgICAgICAgYWRkQ2FyZFBvcHVwLmNsb3NlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGNhcmQgZGF0YSByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXJcIik7XG4gICAgICB9XG4gICAgfSlcblxuICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBhZGQgY2FyZDogJHtlcnJvcn1gKTtcbiAgICB9KVxuXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgYWRkQ2FyZFBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgIH0pO1xufVxuXG4vLyBIYW5kbGUgQ2FyZCBEZWxldGVcbmZ1bmN0aW9uIGhhbmRsZUNhcmREZWxldGUoY2FyZElkKSB7XG4gIGNvbnNvbGUudHJhY2UoYGhhbmRsZUNhcmREZWxldGUgY2FsbGVkIHdpdGggSUQ6ICR7Y2FyZElkfWApO1xuICBjb25zb2xlLmxvZyhcImNhcmRJZFwiLCBjYXJkSWQpO1xuXG4gIC8vIE9wZW4gdGhlIGNvbmZpcm1hdGlvbiBwb3B1cCBiZWZvcmUgZGVsZXRpbmcgdGhlIGNhcmRcbiAgZGVsZXRlQ2FyZFBvcHVwLm9wZW4oY2FyZElkKTtcblxuICBkZWxldGVDYXJkUG9wdXAuc2V0Q29uZmlybUhhbmRsZXIoKCkgPT4ge1xuICAgIC8vIFNob3cgbG9hZGluZ1xuICAgIGRlbGV0ZUNhcmRQb3B1cC5yZW5kZXJMb2FkaW5nKHRydWUpO1xuXG4gICAgYXBpXG4gICAgICAuZGVsZXRlQ2FyZChjYXJkSWQpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBEZWxldGVkIGNhcmQgd2l0aCBJRDogJHtjYXJkSWR9YCk7XG4gICAgICAgIGNhcmRMaXN0LnJlbW92ZUl0ZW0oY2FyZElkKTtcbiAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZGVsZXRlIGNhcmQ6ICR7ZXJyb3J9YCk7XG4gICAgICB9KVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAvLyBIaWRlIGxvYWRpbmdcbiAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGNhcmREYXRhLCB1c2VySWQpIHtcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxuICAgIGNhcmREYXRhLFxuICAgIFwiI2NhcmQtdGVtcGxhdGVcIixcbiAgICBvcGVuSW1hZ2VNb2RhbCxcbiAgICBoYW5kbGVDYXJkTGlrZSxcbiAgICBoYW5kbGVDYXJkRGVsZXRlLFxuICAgIHVzZXJJZCxcbiAgICBjYXJkTGlzdFxuICApO1xuXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIG9wZW5JbWFnZU1vZGFsKGNhcmREYXRhKSB7XG4gIGltYWdlUG9wdXAub3BlbihjYXJkRGF0YSk7XG59XG5cbi8vIEhhbmRsZSBDYXJkIExpa2VcbmZ1bmN0aW9uIGhhbmRsZUNhcmRMaWtlKGNhcmQpIHtcbiAgaWYgKGNhcmQuaXNMaWtlZCgpKSB7XG4gICAgYXBpXG4gICAgICAucmVtb3ZlTGlrZShjYXJkLl9pZClcbiAgICAgIC50aGVuKCh1cGRhdGVkQ2FyZERhdGEpID0+IHtcbiAgICAgICAgY2FyZC51cGRhdGVMaWtlcyh1cGRhdGVkQ2FyZERhdGEubGlrZXMpO1xuICAgICAgICByZXR1cm4gdXBkYXRlZENhcmREYXRhO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHJlbW92ZSBsaWtlOiAke2Vycm9yfWApO1xuICAgICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXBpXG4gICAgICAuYWRkTGlrZShjYXJkLl9pZClcbiAgICAgIC50aGVuKCh1cGRhdGVkQ2FyZERhdGEpID0+IHtcbiAgICAgICAgY2FyZC51cGRhdGVMaWtlcyh1cGRhdGVkQ2FyZERhdGEubGlrZXMpO1xuICAgICAgICByZXR1cm4gdXBkYXRlZENhcmREYXRhO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGFkZCBsaWtlOiAke2Vycm9yfWApO1xuICAgICAgfSk7XG4gIH1cbn1cblxuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gYXZhdGFyUG9wdXAub3BlbigpKTtcblxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY29uc3QgcHJvZmlsZUluZm8gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBwcm9maWxlVGl0bGVJbnB1dC52YWx1ZSA9IHByb2ZpbGVJbmZvLm5hbWU7XG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZUluZm8uam9iO1xuICBwcm9maWxlRWRpdEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XG4gIHByb2ZpbGVFZGl0UG9wdXAub3BlbigpO1xufSk7XG5cbmF2YXRhck1vZGFsQ2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYXZhdGFyUG9wdXAuY2xvc2UoKTtcbn0pO1xuXG5hZGROZXdDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGFkZENhcmRGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xuICBhZGRDYXJkUG9wdXAub3BlbigpO1xufSk7XG5cbi8vIEZvcm0gVmFsaWRhdGlvblxuY29uc3QgZm9ybUNvbmZpZyA9IHtcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuY29uc3QgcHJvZmlsZUVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXG4gIGZvcm1Db25maWcsXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LW1vZGFsIGZvcm1cIilcbik7XG5wcm9maWxlRWRpdEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBhZGRDYXJkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFxuICBmb3JtQ29uZmlnLFxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1tb2RhbCBmb3JtXCIpXG4pO1xuYWRkQ2FyZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG4vLyBQb3B1cCBJbnN0YW5jZXNcbmNvbnN0IGF2YXRhclBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiI2VkaXQtYXZhdGFyLW1vZGFsXCIsXG4gIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQsXG4gIFwiU2F2aW5nLi4uXCJcbik7XG5hdmF0YXJQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBwcm9maWxlRWRpdFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiLFxuICBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdCxcbiAgXCJTYXZpbmcuLi5cIlxuKTtcbnByb2ZpbGVFZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuLy8gUG9wdXBXaXRoRm9ybSBpbnN0YW5jZSBmb3IgQWRkIE1vZGFsXG5jb25zdCBhZGRDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIjYWRkLW1vZGFsXCIsXG4gIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0LFxuICBcIlNhdmluZy4uLlwiXG4pO1xuYWRkQ2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGRlbGV0ZUNhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhDb25maXJtYXRpb24oXCIjZGVsZXRlLW1vZGFsXCIpO1xuXG5kZWxldGVDYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuLy8gSW1hZ2UgUG9wdXAgSW5zdGFuY2VcbmNvbnN0IGltYWdlUG9wdXAgPSBuZXcgSW1hZ2VQb3B1cChcIiNwcmV2aWV3X19pbWFnZS1tb2RhbFwiKTtcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiIsImNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3IoeyBuYW1lU2VsZWN0b3IsIGpvYlNlbGVjdG9yLCBhdmF0YXJTZWxlY3RvciB9KSB7XG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XG4gICAgdGhpcy5fam9iRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xuICAgIHRoaXMuX2F2YXRhckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhclNlbGVjdG9yKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCxcbiAgICAgIGpvYjogdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudCxcbiAgICAgIGF2YXRhcjogdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMsXG4gICAgfTtcbiAgfVxuXG4gIHNldFVzZXJJbmZvKG5hbWUsIGpvYiwgYXZhdGFyKSB7XG4gICAgdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQgPSBqb2I7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMgPSBhdmF0YXI7XG4gIH1cblxuICBnZXRBdmF0YXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjO1xuICB9XG5cbiAgc2V0QXZhdGFyKGF2YXRhcikge1xuICAgIHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjID0gYXZhdGFyO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFVzZXJJbmZvO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aENvbmZpcm1hdGlvbiBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgbG9hZGluZ0J1dHRvblRleHQgPSBcIlNhdmluZy4uLlwiKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5fY29uZmlybUJ1dHRvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZVwiKTtcbiAgICB0aGlzLl9jb25maXJtQnV0dG9uVGV4dCA9IHRoaXMuX2NvbmZpcm1CdXR0b24udGV4dENvbnRlbnQ7XG4gICAgdGhpcy5fY29uZmlybURlbGV0ZUJ1dHRvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIubW9kYWxfX2RlbGV0ZS1idXR0b25cIlxuICAgICk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5tb2RhbF9fZGVsZXRlLWJ1dHRvblwiXG4gICAgKTtcbiAgICB0aGlzLl9idXR0b25UZXh0ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xuICAgIHRoaXMuX2xvYWRpbmdCdXR0b25UZXh0ID0gbG9hZGluZ0J1dHRvblRleHQ7XG4gIH1cblxuICBzZXRDb25maXJtSGFuZGxlcihoYW5kbGVyKSB7XG4gICAgdGhpcy5fY29uZmlybUhhbmRsZXIgPSBoYW5kbGVyO1xuICAgIHRoaXMuX2NvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2NvbmZpcm1IYW5kbGVyKCk7XG4gICAgfSk7XG4gICAgdGhpcy5fY29uZmlybURlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5fY29uZmlybUhhbmRsZXIoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgdGhpcy5fY29uZmlybUJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fY29uZmlybUhhbmRsZXIpO1xuICAgIHRoaXMuX2NvbmZpcm1EZWxldGVCdXR0b24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgIFwiY2xpY2tcIixcbiAgICAgIHRoaXMuX2NvbmZpcm1IYW5kbGVyXG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nKSB7XG4gICAgY29uc29sZS5sb2coXCJyZW5kZXJMb2FkaW5nIGNhbGxlZCB3aXRoOiBcIiwgaXNMb2FkaW5nKTtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9sb2FkaW5nQnV0dG9uVGV4dDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy5fYnV0dG9uVGV4dDtcbiAgICB9XG4gICAgY29uc29sZS5sb2coXG4gICAgICBcIkJ1dHRvbiB0ZXh0IGFmdGVyIHJlbmRlckxvYWRpbmc6IFwiLFxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50XG4gICAgKTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEltYWdlUG9wdXAgZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwRWxlbWVudCkge1xuICAgIHN1cGVyKHBvcHVwRWxlbWVudCk7XG4gICAgdGhpcy5faW1hZ2VFbGVtZW50ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5tb2RhbF9fcHJldmlldy1pbWFnZVwiXG4gICAgKTtcbiAgICB0aGlzLl9pbWFnZUNhcHRpb24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLm1vZGFsX19wcmV2aWV3LXRpdGxlXCJcbiAgICApO1xuICB9XG5cbiAgb3BlbihpbWFnZURhdGEpIHtcbiAgICB0aGlzLl9pbWFnZUVsZW1lbnQuc3JjID0gaW1hZ2VEYXRhLmxpbms7XG4gICAgdGhpcy5faW1hZ2VFbGVtZW50LmFsdCA9IGltYWdlRGF0YS5uYW1lO1xuICAgIHRoaXMuX2ltYWdlQ2FwdGlvbi50ZXh0Q29udGVudCA9IGltYWdlRGF0YS5uYW1lO1xuXG4gICAgc3VwZXIub3BlbigpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiYXBpIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwidGhpcyIsIl9iYXNlVXJsIiwiYmFzZVVybCIsIl9oZWFkZXJzIiwiaGVhZGVycyIsIl9jaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0SW5pdGlhbENhcmRzIiwiZWRpdFByb2ZpbGUiLCJuYW1lIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZENhcmQiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImFkZExpa2UiLCJyZW1vdmVMaWtlIiwidXBkYXRlQXZhdGFyIiwiYXZhdGFyTGluayIsImF2YXRhciIsImxvYWREYXRhIiwiYWxsIiwiX3JlZiIsInVzZXJJbmZvIiwiaW5pdGlhbENhcmRzIiwiYXV0aG9yaXphdGlvbiIsIkZvcm1WYWxpZGF0b3IiLCJjb25maWciLCJmb3JtRWxlbWVudCIsIl9jb25maWciLCJfZm9ybUVsZW1lbnQiLCJfaW5wdXRMaXN0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJfYnV0dG9uRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIl9oYXNJbnZhbGlkSW5wdXQiLCJzb21lIiwiaW5wdXRFbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImNsYXNzTGlzdCIsImFkZCIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJkaXNhYmxlZCIsInJlbW92ZSIsIl9oaWRlSW5wdXRFcnJvciIsImVycm9yRWxlbWVudCIsImlkIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsInRleHRDb250ZW50IiwiX3Nob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkYXRpb25NZXNzYWdlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJyZXNldFZhbGlkYXRpb24iLCJDYXJkIiwiY2FyZERhdGEiLCJjYXJkVGVtcGxhdGVTZWxlY3RvciIsIm9wZW5JbWFnZU1vZGFsIiwiaGFuZGxlQ2FyZExpa2UiLCJoYW5kbGVDYXJkRGVsZXRlIiwidXNlcklkIiwiY2FyZExpc3QiLCJfbmFtZSIsIl9saW5rIiwiX2lkIiwiX2xpa2VzIiwibGlrZXMiLCJfb3duZXJJZCIsIm93bmVyIiwiX2NhcmRTZWxlY3RvciIsIl9vcGVuSW1hZ2VNb2RhbCIsIl9oYW5kbGVMaWtlIiwiX2hhbmRsZURlbGV0ZSIsIl9jYXJkTGlzdCIsIl91c2VySWQiLCJfZ2V0VGVtcGxhdGUiLCJkb2N1bWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfZWxlbWVudCIsImV2ZW50IiwidXBkYXRlTGlrZXMiLCJfcmVuZGVyTGlrZXMiLCJsZW5ndGgiLCJ0b2dnbGUiLCJpc0xpa2VkIiwibGlrZSIsImdldElkIiwiZ2VuZXJhdGVDYXJkIiwic2V0QXR0cmlidXRlIiwic3JjIiwiYWx0IiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cEVsZW1lbnQiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwiX2Nsb3NlQnV0dG9uIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiUG9wdXBXaXRoRm9ybSIsIlBvcHVwIiwiaGFuZGxlU3VibWl0IiwibG9hZGluZ0J1dHRvblRleHQiLCJzdXBlciIsIl9oYW5kbGVTdWJtaXQiLCJfc3VibWl0QnV0dG9uIiwiX2J1dHRvblRleHQiLCJfbG9hZGluZ0J1dHRvblRleHQiLCJyZXNldCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dHMiLCJpbnB1dFZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJlIiwicHJvZmlsZUVkaXRCdXR0b24iLCJwcm9maWxlVGl0bGVJbnB1dCIsInByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwiYWRkTmV3Q2FyZEJ1dHRvbiIsImF2YXRhckVkaXRCdXR0b24iLCJhdmF0YXJNb2RhbENsb3NlQnV0dG9uIiwiY29uc29sZSIsInRyYWNlIiwibG9nIiwiZGVsZXRlQ2FyZFBvcHVwIiwic2V0Q29uZmlybUhhbmRsZXIiLCJyZW1vdmVJdGVtIiwiY2F0Y2giLCJlcnJvciIsImZpbmFsbHkiLCJjcmVhdGVDYXJkIiwiaW1hZ2VQb3B1cCIsImNhcmQiLCJ1cGRhdGVkQ2FyZERhdGEiLCJnZXRFbGVtZW50QnlJZCIsInVzZXJJbmZvRGF0YSIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsIl9hdmF0YXJFbGVtZW50Iiwiam9iIiwic2V0VXNlckluZm8iLCJnZXRBdmF0YXIiLCJzZXRBdmF0YXIiLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJyZXZlcnNlIiwiaXRlbSIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsIml0ZW1JZCIsIml0ZW1FbGVtZW50IiwiY2FyZEVsZW1lbnQiLCJhdmF0YXJQb3B1cCIsInByb2ZpbGVJbmZvIiwicHJvZmlsZUVkaXRGb3JtVmFsaWRhdG9yIiwicHJvZmlsZUVkaXRQb3B1cCIsImFkZENhcmRGb3JtVmFsaWRhdG9yIiwiYWRkQ2FyZFBvcHVwIiwiZm9ybUNvbmZpZyIsImZvcm1EYXRhIiwibmFtZUlucHV0Iiwiam9iSW5wdXQiLCJ1cGRhdGVkSW5mbyIsIm5ld0NhcmREYXRhIiwiRXJyb3IiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJfY29uZmlybUJ1dHRvbiIsIl9jb25maXJtQnV0dG9uVGV4dCIsIl9jb25maXJtRGVsZXRlQnV0dG9uIiwiaGFuZGxlciIsIl9jb25maXJtSGFuZGxlciIsInBvcHVwRWxlbWVudCIsIl9pbWFnZUVsZW1lbnQiLCJfaW1hZ2VDYXB0aW9uIiwiaW1hZ2VEYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==